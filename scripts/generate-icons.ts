import * as fs from 'node:fs';
import * as path from 'node:path';
import * as url from 'node:url';
import { Browser, chromium } from 'playwright';
import { create, fragment } from 'xmlbuilder2';

const DEST_FOLDER = url.fileURLToPath(new URL('../images', import.meta.url));
const XCODE_DEST_FOLDER = url.fileURLToPath(
  new URL(
    '../xcode13/Shared (App)/Assets.xcassets/LargeIcon.imageset',
    import.meta.url
  )
);
const SVG_NS = 'http://www.w3.org/2000/svg';

async function main() {
  const browser = await chromium.launch();

  await saveIcon({
    browser,
    enabled: true,
    sizes: [128, 256, 384],
    style: '10',
    withSVG: false,
    writePath: XCODE_DEST_FOLDER,
  });

  for (const style of ['10', '天'] as const) {
    for (const enabled of [true, false]) {
      // Generic icons
      await saveIcon({
        browser,
        enabled,
        sizes: [16, 32, 48, 96, 128],
        style,
        withSVG: true,
        writePath: DEST_FOLDER,
      });

      // Progress icons
      for (const progress of [
        0,
        20,
        40,
        60,
        80,
        100,
        'indeterminate',
      ] as const) {
        for (const color of ['green', 'blue', 'purple'] as const) {
          await saveIcon({
            browser,
            enabled,
            progress: { value: progress, color },
            sizes: [16, 32, 48],
            style,
            withSVG: true,
            writePath: DEST_FOLDER,
          });
        }
      }
    }

    // Error icons
    await saveIcon({
      badge: 'error',
      browser,
      enabled: false,
      sizes: [16, 32, 48],
      style,
      withSVG: true,
      writePath: DEST_FOLDER,
    });
  }

  await browser.close();
}

async function saveIcon({
  badge,
  browser,
  enabled,
  progress,
  sizes,
  style,
  withSVG,
  writePath,
}: {
  badge?: 'error';
  browser: Browser;
  enabled: boolean;
  progress?: {
    value: 0 | 20 | 40 | 60 | 80 | 100 | 'indeterminate';
    color: 'green' | 'blue' | 'purple';
  };
  sizes: Array<16 | 32 | 48 | 96 | 128 | 256 | 384>;
  style: '10' | '天';
  withSVG: boolean;
  writePath: string;
}) {
  // Filename
  const filenameParts = ['10ten'];
  if (style === '天') {
    filenameParts.push('sky');
  }
  if (!enabled && badge !== 'error') {
    filenameParts.push('disabled');
  }
  if (badge === 'error') {
    filenameParts.push('error');
  }
  if (progress) {
    const { value, color } = progress;
    filenameParts.push(typeof value === 'number' ? `${value}p` : value);
    filenameParts.push(color);
  }

  // SVG version
  if (withSVG) {
    const svg = generateSvg({ badge, enabled, progress, size: 32, style });
    const filename = filenameParts.join('-') + '.svg';
    console.log(`Writing ${filename}...`);
    fs.writeFileSync(path.join(writePath, filename), svg);
  }

  // PNG versions
  for (const size of sizes) {
    const page = await browser.newPage();
    const svg = generateSvg({ badge, enabled, progress, size, style });
    const svgUrl = `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
    await page.setContent(
      `<html><body><img id="img" src="${svgUrl}" width="${size}" height="${size}"></body></html>`
    );
    const filename = filenameParts.join('-') + `-${size}.png`;
    const dest = path.join(writePath, filename);
    console.log(`Writing ${filename}...`);
    await page.locator('#img').screenshot({ omitBackground: true, path: dest });
  }
}

const COLORS = {
  green: ['green', 'lime'],
  blue: ['#004d91', '#26bdfb'],
  purple: ['#5b006e', '#e458fa'],
};

function generateSvg({
  badge,
  enabled,
  progress,
  size,
  style,
}: {
  badge?: 'error';
  enabled: boolean;
  progress?: {
    value: 0 | 20 | 40 | 60 | 80 | 100 | 'indeterminate';
    color: 'green' | 'blue' | 'purple';
  };
  size: 16 | 32 | 48 | 96 | 128 | 256 | 384;
  style: '10' | '天';
}) {
  const svg = create().ele('svg', {
    xmlns: SVG_NS,
    viewBox: `0 0 ${size} ${size}`,
  });

  // Progress bar gradient
  if (progress) {
    if (size > 48) {
      throw new Error('Progress bar is only supported for sizes <= 48');
    }

    const gradientDimension = {
      16: {
        x1: '-.42',
        x2: '-.42',
        y1: -137.42,
        y2: -137.5,
        gradientTransform: 'translate(6 -2735) scale(10 -20)',
      },
      32: {
        x1: -16.4,
        x2: -16.4,
        y1: -138.09,
        y2: -138.24,
        gradientTransform: 'translate(168 -2735) scale(10 -20)',
      },
      48: {
        x1: -46.87,
        x2: -46.87,
        y1: -138.76,
        y2: -138.99,
        gradientTransform: 'translate(474 -2735) scale(10 -20)',
      },
    };

    svg
      .ele('defs')
      .ele('linearGradient', {
        id: 'linear-gradient',
        ...gradientDimension[size as 16 | 32 | 48],
        gradientUnits: 'userSpaceOnUse',
      })
      .ele('stop', { offset: '.2', 'stop-color': COLORS[progress.color][1] })
      .up()
      .ele('stop', { offset: 1, 'stop-color': COLORS[progress.color][0] });
  }

  // Background
  const backgroundRounding = {
    16: 2.5,
    32: 5,
    48: 7.5,
    96: 15,
    128: 20,
    256: 40,
    384: 60,
  };
  svg.ele('rect', {
    width: size,
    height: size,
    fill: enabled ? '#1d1a19' : 'white',
    opacity: enabled ? undefined : '0.5',
    rx: backgroundRounding[size],
  });

  // 10ten logo
  svg.import(getLogo({ enabled, size, style }));

  // Progress bar
  if (progress) {
    if (size > 48) {
      throw new Error('Progress bar is only supported for sizes <= 48');
    }

    svg.import(
      getProgressBar({
        color: progress.color,
        enabled,
        value: progress.value,
        size: size as 16 | 32 | 48,
      })
    );
  }

  // Error badge
  if (badge === 'error') {
    if (progress) {
      throw new Error('Error badge is not supported with progress bar');
    }
    if (enabled) {
      throw new Error('Error badge is only shown in disabled state');
    }
    if (size > 48) {
      throw new Error('Error badge is only supported for sizes <= 48');
    }
    svg.import(getErrorBadge(size as 16 | 32 | 48));
  }

  return svg.end({ headless: true, prettyPrint: true });
}

function getLogo({
  enabled,
  size,
  style,
}: {
  enabled: boolean;
  size: 16 | 32 | 48 | 96 | 128 | 256 | 384;
  style: '10' | '天';
}) {
  // const blueDot = {
  //   '10': {
  //     16: { cx: 13.5, cy: 11.5, r: 0.9 },
  //     32: { cx: 26.5, cy: 22.5, r: 1.8 },
  //     48: { cx: 39.5, cy: 34, r: 2.7 },
  //     96: { cx: 73, cy: 64.5, r: 4.5 },
  //     128: { cx: 98, cy: 86, r: 6 },
  //   },
  //   天: {
  //     16: { cx: 13.5, cy: 11.5, r: 1.1 },
  //     32: { cx: 27, cy: 23, r: 1.82 },
  //     48: { cx: 40, cy: 34.5, r: 2.7 },
  //     96: { cx: 74.5, cy: 66, r: 4.55 },
  //     128: { cx: 99, cy: 86, r: 6 },
  //   },
  // };
  // const yellowDot = {
  //   '10': {
  //     16: { cx: 9, cy: 8, r: 0.9 },
  //     32: { cx: 18, cy: 16, r: 1.8 },
  //     48: { cx: 27, cy: 24, r: 2.7 },
  //     96: { cx: 52, cy: 48, r: 4.5 },
  //     128: { cx: 70, cy: 64, r: 6 },
  //   },
  //   天: {
  //     16: { cx: 2.5, cy: 4.5, r: 1.1 },
  //     32: { cx: 5, cy: 9.5, r: 1.82 },
  //     48: { cx: 8, cy: 14, r: 2.7 },
  //     96: { cx: 21.5, cy: 31, r: 4.55 },
  //     128: { cx: 29, cy: 40, r: 6 },
  //   },
  // };
  const logoPath = {
    '10': {
      16: 'M4.0 10.4v-6.4c0 -0.0 1.5999999999999996 -0.0 1.5999999999999996 0v4.800000000000001c0 1.1199999999999997 0.47999999999999987 1.5999999999999996 1.5999999999999996 1.5999999999999996h4.800000000000001c0.0 0 0.0 1.5999999999999996 0 1.5999999999999996h-6.4c-1.1199999999999997 0 -1.5999999999999996 -0.47999999999999987 -1.5999999999999996 -1.5999999999999996ZM6.719999999999999 7.6800000000000015v-3.680000000000001c0 -0.0 1.5999999999999996 -0.0 1.5999999999999996 0v2.0800000000000014c0 1.1199999999999997 0.47999999999999987 1.5999999999999996 1.5999999999999996 1.5999999999999996h2.0800000000000014c0.0 0 0.0 1.5999999999999996 0 1.5999999999999996h-3.680000000000001c-1.1199999999999997 0 -1.5999999999999996 -0.47999999999999987 -1.5999999999999996 -1.5999999999999996Z',
      32: 'M8.0 20.8v-12.8c0 -0.0 3.1999999999999993 -0.0 3.1999999999999993 0v9.600000000000001c0 2.2399999999999993 0.9599999999999997 3.1999999999999993 3.1999999999999993 3.1999999999999993h9.600000000000001c0.0 0 0.0 3.1999999999999993 0 3.1999999999999993h-12.8c-2.2399999999999993 0 -3.1999999999999993 -0.9599999999999997 -3.1999999999999993 -3.1999999999999993ZM13.439999999999998 15.360000000000003v-7.360000000000002c0 -0.0 3.1999999999999993 -0.0 3.1999999999999993 0v4.160000000000003c0 2.2399999999999993 0.9599999999999997 3.1999999999999993 3.1999999999999993 3.1999999999999993h4.160000000000003c0.0 0 0.0 3.1999999999999993 0 3.1999999999999993h-7.360000000000002c-2.2399999999999993 0 -3.1999999999999993 -0.9599999999999997 -3.1999999999999993 -3.1999999999999993Z',
      48: 'M12.0 31.200000000000003v-19.200000000000003c0 -0.0 4.799999999999999 -0.0 4.799999999999999 0v14.400000000000004c0 3.359999999999999 1.4399999999999997 4.799999999999999 4.799999999999999 4.799999999999999h14.400000000000004c0.0 0 0.0 4.799999999999999 0 4.799999999999999h-19.200000000000003c-3.359999999999999 0 -4.799999999999999 -1.4399999999999997 -4.799999999999999 -4.799999999999999ZM20.159999999999997 23.040000000000006v-11.040000000000004c0 -0.0 4.799999999999999 -0.0 4.799999999999999 0v6.2400000000000055c0 3.359999999999999 1.4399999999999997 4.799999999999999 4.799999999999999 4.799999999999999h6.2400000000000055c0.0 0 0.0 4.799999999999999 0 4.799999999999999h-11.040000000000004c-3.359999999999999 0 -4.799999999999999 -1.4399999999999997 -4.799999999999999 -4.799999999999999Z',
      96: 'M24.0 62.400000000000006v-38.400000000000006c0 -0.0 9.599999999999998 -0.0 9.599999999999998 0v28.800000000000008c0 6.719999999999998 2.8799999999999994 9.599999999999998 9.599999999999998 9.599999999999998h28.800000000000008c0.0 0 0.0 9.599999999999998 0 9.599999999999998h-38.400000000000006c-6.719999999999998 0 -9.599999999999998 -2.8799999999999994 -9.599999999999998 -9.599999999999998ZM40.31999999999999 46.08000000000001v-22.08000000000001c0 -0.0 9.599999999999998 -0.0 9.599999999999998 0v12.480000000000011c0 6.719999999999998 2.8799999999999994 9.599999999999998 9.599999999999998 9.599999999999998h12.480000000000011c0.0 0 0.0 9.599999999999998 0 9.599999999999998h-22.08000000000001c-6.719999999999998 0 -9.599999999999998 -2.8799999999999994 -9.599999999999998 -9.599999999999998Z',
      128: 'M32.0 83.2v-51.2c0 -0.0 12.799999999999997 -0.0 12.799999999999997 0v38.400000000000006c0 8.959999999999997 3.839999999999999 12.799999999999997 12.799999999999997 12.799999999999997h38.400000000000006c0.0 0 0.0 12.799999999999997 0 12.799999999999997h-51.2c-8.959999999999997 0 -12.799999999999997 -3.839999999999999 -12.799999999999997 -12.799999999999997ZM53.75999999999999 61.44000000000001v-29.44000000000001c0 -0.0 12.799999999999997 -0.0 12.799999999999997 0v16.64000000000001c0 8.959999999999997 3.839999999999999 12.799999999999997 12.799999999999997 12.799999999999997h16.64000000000001c0.0 0 0.0 12.799999999999997 0 12.799999999999997h-29.44000000000001c-8.959999999999997 0 -12.799999999999997 -3.839999999999999 -12.799999999999997 -12.799999999999997Z',
      256: 'M64.0 166.4v-102.4c0 -0.0 25.599999999999994 -0.0 25.599999999999994 0v76.80000000000001c0 17.919999999999995 7.679999999999998 25.599999999999994 25.599999999999994 25.599999999999994h76.80000000000001c0.0 0 0.0 25.599999999999994 0 25.599999999999994h-102.4c-17.919999999999995 0 -25.599999999999994 -7.679999999999998 -25.599999999999994 -25.599999999999994ZM107.51999999999998 122.88000000000002v-58.88000000000002c0 -0.0 25.599999999999994 -0.0 25.599999999999994 0v33.28000000000002c0 17.919999999999995 7.679999999999998 25.599999999999994 25.599999999999994 25.599999999999994h33.28000000000002c0.0 0 0.0 25.599999999999994 0 25.599999999999994h-58.88000000000002c-17.919999999999995 0 -25.599999999999994 -7.679999999999998 -25.599999999999994 -25.599999999999994Z',
      384: 'M96.0 249.60000000000002v-153.60000000000002c0 -0.0 38.39999999999999 -0.0 38.39999999999999 0v115.20000000000003c0 26.879999999999992 11.519999999999998 38.39999999999999 38.39999999999999 38.39999999999999h115.20000000000003c0.0 0 0.0 38.39999999999999 0 38.39999999999999h-153.60000000000002c-26.879999999999992 0 -38.39999999999999 -11.519999999999998 -38.39999999999999 -38.39999999999999ZM161.27999999999997 184.32000000000005v-88.32000000000004c0 -0.0 38.39999999999999 -0.0 38.39999999999999 0v49.920000000000044c0 26.879999999999992 11.519999999999998 38.39999999999999 38.39999999999999 38.39999999999999h49.920000000000044c0.0 0 0.0 38.39999999999999 0 38.39999999999999h-88.32000000000004c-26.879999999999992 0 -38.39999999999999 -11.519999999999998 -38.39999999999999 -38.39999999999999Z',
    },
    天: {
      16: 'M4.0 10.4v-6.4c0 -0.0 1.5999999999999996 -0.0 1.5999999999999996 0v4.800000000000001c0 1.1199999999999997 0.47999999999999987 1.5999999999999996 1.5999999999999996 1.5999999999999996h4.800000000000001c0.0 0 0.0 1.5999999999999996 0 1.5999999999999996h-6.4c-1.1199999999999997 0 -1.5999999999999996 -0.47999999999999987 -1.5999999999999996 -1.5999999999999996ZM6.719999999999999 7.6800000000000015v-3.680000000000001c0 -0.0 1.5999999999999996 -0.0 1.5999999999999996 0v2.0800000000000014c0 1.1199999999999997 0.47999999999999987 1.5999999999999996 1.5999999999999996 1.5999999999999996h2.0800000000000014c0.0 0 0.0 1.5999999999999996 0 1.5999999999999996h-3.680000000000001c-1.1199999999999997 0 -1.5999999999999996 -0.47999999999999987 -1.5999999999999996 -1.5999999999999996Z',
      32: 'M8.0 20.8v-12.8c0 -0.0 3.1999999999999993 -0.0 3.1999999999999993 0v9.600000000000001c0 2.2399999999999993 0.9599999999999997 3.1999999999999993 3.1999999999999993 3.1999999999999993h9.600000000000001c0.0 0 0.0 3.1999999999999993 0 3.1999999999999993h-12.8c-2.2399999999999993 0 -3.1999999999999993 -0.9599999999999997 -3.1999999999999993 -3.1999999999999993ZM13.439999999999998 15.360000000000003v-7.360000000000002c0 -0.0 3.1999999999999993 -0.0 3.1999999999999993 0v4.160000000000003c0 2.2399999999999993 0.9599999999999997 3.1999999999999993 3.1999999999999993 3.1999999999999993h4.160000000000003c0.0 0 0.0 3.1999999999999993 0 3.1999999999999993h-7.360000000000002c-2.2399999999999993 0 -3.1999999999999993 -0.9599999999999997 -3.1999999999999993 -3.1999999999999993Z',
      48: 'M12.0 31.200000000000003v-19.200000000000003c0 -0.0 4.799999999999999 -0.0 4.799999999999999 0v14.400000000000004c0 3.359999999999999 1.4399999999999997 4.799999999999999 4.799999999999999 4.799999999999999h14.400000000000004c0.0 0 0.0 4.799999999999999 0 4.799999999999999h-19.200000000000003c-3.359999999999999 0 -4.799999999999999 -1.4399999999999997 -4.799999999999999 -4.799999999999999ZM20.159999999999997 23.040000000000006v-11.040000000000004c0 -0.0 4.799999999999999 -0.0 4.799999999999999 0v6.2400000000000055c0 3.359999999999999 1.4399999999999997 4.799999999999999 4.799999999999999 4.799999999999999h6.2400000000000055c0.0 0 0.0 4.799999999999999 0 4.799999999999999h-11.040000000000004c-3.359999999999999 0 -4.799999999999999 -1.4399999999999997 -4.799999999999999 -4.799999999999999Z',
      96: 'M24.0 62.400000000000006v-38.400000000000006c0 -0.0 9.599999999999998 -0.0 9.599999999999998 0v28.800000000000008c0 6.719999999999998 2.8799999999999994 9.599999999999998 9.599999999999998 9.599999999999998h28.800000000000008c0.0 0 0.0 9.599999999999998 0 9.599999999999998h-38.400000000000006c-6.719999999999998 0 -9.599999999999998 -2.8799999999999994 -9.599999999999998 -9.599999999999998ZM40.31999999999999 46.08000000000001v-22.08000000000001c0 -0.0 9.599999999999998 -0.0 9.599999999999998 0v12.480000000000011c0 6.719999999999998 2.8799999999999994 9.599999999999998 9.599999999999998 9.599999999999998h12.480000000000011c0.0 0 0.0 9.599999999999998 0 9.599999999999998h-22.08000000000001c-6.719999999999998 0 -9.599999999999998 -2.8799999999999994 -9.599999999999998 -9.599999999999998Z',
      128: 'M32.0 83.2v-51.2c0 -0.0 12.799999999999997 -0.0 12.799999999999997 0v38.400000000000006c0 8.959999999999997 3.839999999999999 12.799999999999997 12.799999999999997 12.799999999999997h38.400000000000006c0.0 0 0.0 12.799999999999997 0 12.799999999999997h-51.2c-8.959999999999997 0 -12.799999999999997 -3.839999999999999 -12.799999999999997 -12.799999999999997ZM53.75999999999999 61.44000000000001v-29.44000000000001c0 -0.0 12.799999999999997 -0.0 12.799999999999997 0v16.64000000000001c0 8.959999999999997 3.839999999999999 12.799999999999997 12.799999999999997 12.799999999999997h16.64000000000001c0.0 0 0.0 12.799999999999997 0 12.799999999999997h-29.44000000000001c-8.959999999999997 0 -12.799999999999997 -3.839999999999999 -12.799999999999997 -12.799999999999997Z',
      256: 'M64.0 166.4v-102.4c0 -0.0 25.599999999999994 -0.0 25.599999999999994 0v76.80000000000001c0 17.919999999999995 7.679999999999998 25.599999999999994 25.599999999999994 25.599999999999994h76.80000000000001c0.0 0 0.0 25.599999999999994 0 25.599999999999994h-102.4c-17.919999999999995 0 -25.599999999999994 -7.679999999999998 -25.599999999999994 -25.599999999999994ZM107.51999999999998 122.88000000000002v-58.88000000000002c0 -0.0 25.599999999999994 -0.0 25.599999999999994 0v33.28000000000002c0 17.919999999999995 7.679999999999998 25.599999999999994 25.599999999999994 25.599999999999994h33.28000000000002c0.0 0 0.0 25.599999999999994 0 25.599999999999994h-58.88000000000002c-17.919999999999995 0 -25.599999999999994 -7.679999999999998 -25.599999999999994 -25.599999999999994Z',
      384: 'M96.0 249.60000000000002v-153.60000000000002c0 -0.0 38.39999999999999 -0.0 38.39999999999999 0v115.20000000000003c0 26.879999999999992 11.519999999999998 38.39999999999999 38.39999999999999 38.39999999999999h115.20000000000003c0.0 0 0.0 38.39999999999999 0 38.39999999999999h-153.60000000000002c-26.879999999999992 0 -38.39999999999999 -11.519999999999998 -38.39999999999999 -38.39999999999999ZM161.27999999999997 184.32000000000005v-88.32000000000004c0 -0.0 38.39999999999999 -0.0 38.39999999999999 0v49.920000000000044c0 26.879999999999992 11.519999999999998 38.39999999999999 38.39999999999999 38.39999999999999h49.920000000000044c0.0 0 0.0 38.39999999999999 0 38.39999999999999h-88.32000000000004c-26.879999999999992 0 -38.39999999999999 -11.519999999999998 -38.39999999999999 -38.39999999999999Z',
    },
  };

  return (
    fragment()
      // .ele('circle', {
      //   ...blueDot[style][size],
      //   fill: enabled ? '#2698fb' : '#4a4a4b',
      // })
      // .up()
      // .ele('circle', {
      //   ...yellowDot[style][size],
      //   fill: enabled ? '#ffd500' : '#4a4a4b',
      // })
      // .up()
      .ele('path', {
        d: logoPath[style][size],
        fill: enabled ? 'white' : '#4a4a4b',
      })
      .up()
  );
}

function getProgressBar({
  color,
  enabled,
  value,
  size,
}: {
  color: 'green' | 'blue' | 'purple';
  enabled: boolean;
  value: 0 | 20 | 40 | 60 | 80 | 100 | 'indeterminate';
  size: 16 | 32 | 48;
}) {
  const backgroundPath = {
    16: 'M2.17 13h11.66c.64 0 1.17.52 1.17 1.17 0 .64-.52 1.17-1.17 1.17H2.17c-.64 0-1.17-.52-1.17-1.17 0-.64.52-1.17 1.17-1.17Z',
    32: 'M4.75 26h22.5c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25H4.75c-1.24 0-2.25-1.01-2.25-2.25S3.51 26 4.75 26Z',
    48: 'M6.5 39h35c1.93 0 3.5 1.57 3.5 3.5S43.43 46 41.5 46h-35C4.57 46 3 44.43 3 42.5S4.57 39 6.5 39Z',
  };
  const barPath = {
    0: {
      16: 'M2.17 13.39v1.56c-.39 0-.78-.39-.78-.78s.39-.78.78-.78Z',
      32: 'M4.75 26.75v3c-.75 0-1.5-.75-1.5-1.5s.75-1.5 1.5-1.5Z',
      48: 'M6.5 40.17v4.67c-1.17 0-2.33-1.17-2.33-2.33s1.17-2.33 2.33-2.33Z',
    },
    20: {
      16: 'M2.17 13.39h2.31v1.54H2.17c-.38 0-.77-.38-.77-.77s.38-.77.77-.77Z',
      32: 'M4.75 26.75H9.2v2.97H4.75c-.74 0-1.48-.74-1.48-1.48s.74-1.48 1.48-1.48Z',
      48: 'M6.5 40.17h7v4.67h-7c-1.17 0-2.33-1.17-2.33-2.33s1.17-2.33 2.33-2.33Z',
    },
    40: {
      16: 'M2.17 13.39h4.66v1.56H2.17c-.39 0-.78-.39-.78-.78s.39-.78.78-.78Z',
      32: 'M4.75 26.75h9v3h-9c-.75 0-1.5-.75-1.5-1.5s.75-1.5 1.5-1.5Z',
      48: 'M6.5 40.17h14v4.67h-14c-1.17 0-2.33-1.17-2.33-2.33s1.17-2.33 2.33-2.33Z',
    },
    60: {
      16: 'M2.17 13.39h7v1.56h-7c-.39 0-.78-.39-.78-.78s.39-.78.78-.78Z',
      32: 'M4.75 26.75h13.5v3H4.75c-.75 0-1.5-.75-1.5-1.5s.75-1.5 1.5-1.5Z',
      48: 'M6.5 40.17h21v4.67h-21c-1.17 0-2.33-1.17-2.33-2.33s1.17-2.33 2.33-2.33Z',
    },
    80: {
      16: 'M2.17 13.39h9.33v1.56H2.17c-.39 0-.78-.39-.78-.78s.39-.78.78-.78Z',
      32: 'M4.75 26.75h18v3h-18c-.75 0-1.5-.75-1.5-1.5s.75-1.5 1.5-1.5Z',
      48: 'M6.5 40.17h28v4.67h-28c-1.17 0-2.33-1.17-2.33-2.33s1.17-2.33 2.33-2.33Z',
    },
    100: {
      16: 'M2.19 13.39h11.67c.39 0 .78.39.78.78s-.39.78-.78.78H2.19c-.39 0-.78-.39-.78-.78s.39-.78.78-.78Z',
      32: 'M4.8 26.75h22.5c.75 0 1.5.75 1.5 1.5s-.75 1.5-1.5 1.5H4.8c-.75 0-1.5-.75-1.5-1.5s.75-1.5 1.5-1.5Z',
      48: 'M6.5 40.17h35c1.17 0 2.33 1.17 2.33 2.33s-1.17 2.33-2.33 2.33h-35c-1.17 0-2.33-1.17-2.33-2.33s1.17-2.33 2.33-2.33Z',
    },
  };
  const indeterminatePath = {
    16: 'm2.19 14.94 1.5-1.56h1.13l-1.5 1.56H2.19Zm2.25 0 1.5-1.56h1.13l-1.5 1.56H4.44Zm2.25 0 1.5-1.56h1.13l-1.5 1.56H6.69Zm2.25 0 1.5-1.56h1.13l-1.5 1.56H8.94Zm2.25 0 1.5-1.56h1.13l-1.5 1.56h-1.13Z',
    32: 'm4.8 29.75 2.9-3h2.17l-2.9 3H4.8Zm4.35 0 2.9-3h2.17l-2.9 3H9.15Zm4.35 0 2.9-3h2.17l-2.9 3H13.5Zm4.35 0 2.9-3h2.17l-2.9 3h-2.17Zm4.35 0 2.9-3h2.17l-2.9 3H22.2Z',
    48: 'm6.57 44.83 4.44-4.67h3.33L9.9 44.83H6.57Zm6.66 0 4.44-4.67H21l-4.44 4.67h-3.33Zm6.66 0 4.44-4.67h3.33l-4.44 4.67h-3.33Zm6.66 0 4.44-4.67h3.33l-4.44 4.67h-3.33Zm6.66 0 4.44-4.67h3.33l-4.44 4.67h-3.33Z',
  };

  const result = fragment();
  result
    .ele('path', {
      d: backgroundPath[size],
      fill: enabled ? undefined : '#4a4a4b',
      'fill-opacity': enabled ? '.7' : undefined,
    })
    .up()
    .ele('path', {
      d: barPath[value === 'indeterminate' ? 100 : value][size],
      fill: 'url(#linear-gradient)',
    });

  if (value === 'indeterminate') {
    result.ele('path', { d: indeterminatePath[size], fill: COLORS[color][0] });
  }

  return result;
}

function getErrorBadge(size: 16 | 32 | 48) {
  const trianglePath = {
    16: 'M14.76 3.28 13.52.8a.488.488 0 0 0-.67-.22.47.47 0 0 0-.22.22l-1.24 2.48a.5.5 0 0 0 .45.72h2.48c.28 0 .5-.22.5-.5 0-.08-.02-.15-.05-.22Z',
    32: 'm30.88 7.34-2.85-5.7c-.28-.57-.98-.8-1.54-.51-.22.11-.4.29-.51.51l-2.85 5.7A1.149 1.149 0 0 0 24.16 9h5.7c.64 0 1.15-.51 1.15-1.15 0-.18-.04-.35-.12-.51Z',
    48: 'm46 11.16-4.27-8.55a1.728 1.728 0 0 0-3.09 0l-4.27 8.55c-.42.85-.08 1.89.78 2.31.24.12.5.18.77.18h8.55a1.73 1.73 0 0 0 1.55-2.5Z',
  };
  const exclamationMark = {
    16: 'M12.79 1.47c0-.14.13-.25.29-.25s.29.11.29.25v1c0 .14-.13.25-.29.25s-.29-.11-.29-.25v-1Zm.29 2.1a.29.29 0 1 1 0-.58.29.29 0 0 1 0 .58Z',
    32: 'M26.33 3.18c0-.32.3-.58.67-.58s.67.26.67.58v2.3c0 .32-.3.58-.67.58s-.67-.26-.67-.58v-2.3ZM27 8a.67.67 0 1 1 0-1.34A.67.67 0 0 1 27 8Z',
    48: 'M39.18 4.93c0-.48.45-.86 1-.86s1 .39 1 .86v3.45c0 .48-.45.86-1 .86s-1-.39-1-.86V4.93Zm1 7.23c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1Z',
  };

  return fragment()
    .ele('path', {
      d: trianglePath[size],
      fill: '#f24b59',
    })
    .up()
    .ele('path', {
      d: exclamationMark[size],
      fill: 'white',
    })
    .up();
}

main()
  .then(() => {
    console.log('Done.');
  })
  .catch((e) => {
    console.error('Unhandled error');
    console.error(e);
    process.exit(1);
  });
